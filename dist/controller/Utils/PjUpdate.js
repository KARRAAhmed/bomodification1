sap.ui.define(["sap/ui/core/Fragment","sap/m/MessagePopover","sap/m/MessageItem","sap/ui/core/Core","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/m/UploadCollectionItem","sap/m/MessageBox"],function(e,t,s,a,r,o,i,n){"use strict";var l={onBeforeUploadStarts:function(e){var t=this.sNewDocId;var s=new sap.m.UploadCollectionParameter({name:"slug",value:e.getParameter("fileName")});e.getParameters().addHeaderParameter(s);var a=this.getView().getModel();a.refreshSecurityToken();var r=a.oHeaders;var o=r["x-csrf-token"];var i=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:o});e.getParameters().addHeaderParameter(i);var n=new sap.m.UploadCollectionParameter({name:"slug",value:"Zrefde="+t});e.getParameters().addHeaderParameter(n)},onUploadComplete:function(e){var t=this.getView().byId("pjUploader");if(t._aFileUploadersForPendingUpload.length===0){this.getOwnerComponent().getEventBus().publish("BoChannel","uploadComplete")}},uploadFilesFromPC:async function(e){this.sNewDocId=e;var t=this.getView().byId("pjUploader");t.upload();this.pjUpdateHdler.refreshPjs.apply(this)},refreshPjs:function(){var e=this,t=this.getView().getBindingContext().getProperty("Zrefde"),s="/Document_entrantSet('"+t+"')/ToPiecesJointes";this.getView().byId("pjUploader").setBusy(true);var a=this.getView().getModel("piecesJointesModel");if(a){a.setData(null);a.updateBindings(true)}e.getOwnerComponent().getModel().read(s,{success:function(t){e.getView().getModel("piecesJointesModel").setData(t.results);e.getView().byId("pjUploader").setBusy(false)},error:function(t){e.getView().byId("pjUploader").setBusy(false)}})},getPjs:async function(e){var t=this,s="/Document_entrantSet('"+e+"')/ToPiecesJointes";this.getView().byId("pjUploader").setBusy(true);return new Promise((e,a)=>{t.getOwnerComponent().getModel().read(s,{success:function(s){t.getView().getModel("piecesJointesModel").setData(s.results);t.getView().getModel("piecesJointesModel").refresh();t.getView().byId("pjUploader").setBusy(false);e()},error:function(e){a(e);t.getView().byId("pjUploader").setBusy(false)}})})},upDateFilesFromPc:function(e){this.sNewDocId=e;var t=this.getView().getModel("piecesJointesModel").getData();var s=this.getView().byId("pjUploader");s.upload()},onPjDelete:async function(e){var t=this;var s=e.getSource().getFileName(),a=this.getView().getBindingContext().getProperty("Zrefde");await this.pjUpdateHdler.confirmDeletePj.apply(this,[e.getSource().getFileName()]);this.getView().byId("pjUploader").setBusy(true);this.getOwnerComponent().getModel().callFunction("/deleteDePjs",{method:"POST",urlParameters:{file_name:s,Zrefde:a},success:function(e){t.getView().byId("pjUploader").setBusy(false);t.pjUpdateHdler.refreshPjs.apply(t)},error:function(e){t.getView().byId("pjUploader").setBusy(false)}})},confirmDeletePj:async function(){var e=this.getOwnerComponent().getModel("i18n").getResourceBundle();var t=!!this.getView().$().closest(".sapUiSizeCompact").length;var s=this;return new Promise(function(s,a){n.confirm(e.getText("ConfirmDelete"),{styleClass:t?"sapUiSizeCompact":"",actions:[e.getText("Oui"),e.getText("Non")],onClose:function(e){if(e==="Oui"){s()}else{a()}}})})},deletePjs:async function(){var e=this.aPjsToDelete.join(";");var t=this.getView().getBindingContext().getProperty("Zrefde");var s=this.getOwnerComponent().getModel();return new Promise((a,r)=>{if(this.aPjsToDelete.length>0){s.callFunction("/deleteDePjs",{method:"POST",urlParameters:{file_name:e,Zrefde:t},success:function(e){a(true)},error:function(e){r(false)}})}else{a(true)}})}};return l});